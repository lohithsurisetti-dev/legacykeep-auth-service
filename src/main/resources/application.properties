# =============================================================================
# LegacyKeep Auth Service - Main Configuration
# =============================================================================

# Server Configuration
server.port=8081
server.servlet.context-path=/api/v1

# Application Information
spring.application.name=auth-service
info.app.name=LegacyKeep Auth Service
info.app.version=1.0.0
info.app.description=Authentication and Authorization microservice

# =============================================================================
# Database Configuration
# =============================================================================
spring.datasource.url=jdbc:postgresql://localhost:5432/auth_db
spring.datasource.username=${DB_USERNAME:legacykeep}
spring.datasource.password=${DB_PASSWORD:password}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA Configuration
spring.jpa.hibernate.ddl-auto=validate
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=true

# Flyway Migration
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration
spring.flyway.baseline-on-migrate=true
spring.flyway.validate-on-migrate=true
spring.flyway.clean-disabled=true

# =============================================================================
# Redis Configuration
# =============================================================================
spring.redis.host=${REDIS_HOST:localhost}
spring.redis.port=${REDIS_PORT:6379}
spring.redis.password=${REDIS_PASSWORD:}
spring.redis.timeout=2000ms
spring.redis.lettuce.pool.max-active=8
spring.redis.lettuce.pool.max-idle=8
spring.redis.lettuce.pool.min-idle=0

# =============================================================================
# JWT Configuration
# =============================================================================
auth.jwt.secret-key=${JWT_SECRET_KEY:legacykeep-jwt-secret-key-change-in-production-512-bits-minimum-required-for-hs512-algorithm}
auth.jwt.issuer=LegacyKeep
auth.jwt.audience=LegacyKeep-Users
auth.jwt.access-token-expiration-minutes=15
auth.jwt.refresh-token-expiration-days=30
auth.jwt.remember-me-expiration-days=90
auth.jwt.max-concurrent-sessions=5
auth.jwt.token-rotation-enabled=true
auth.jwt.blacklist-expired-tokens=true
auth.jwt.include-roles-in-claims=true
auth.jwt.include-permissions-in-claims=true
auth.jwt.include-device-info-in-claims=true
auth.jwt.algorithm=HS256
auth.jwt.token-prefix=Bearer 
auth.jwt.header-name=Authorization
auth.jwt.refresh-token-cookie-name=refresh_token
auth.jwt.remember-me-cookie-name=remember_me
auth.jwt.secure-cookies=false
auth.jwt.http-only-cookies=true
auth.jwt.same-site-policy=Strict

# =============================================================================
# Password Policy
# =============================================================================
auth.password.min-length=8
auth.password.max-length=128
auth.password.require-uppercase=true
auth.password.require-lowercase=true
auth.password.require-numbers=true
auth.password.require-special-chars=true
auth.password.prevent-common-passwords=true
auth.password.history-size=5
auth.password.expiry-days=90

# =============================================================================
# Rate Limiting
# =============================================================================
auth.rate-limit.login.max-attempts=5
auth.rate-limit.login.window-minutes=15
auth.rate-limit.registration.max-attempts=3
auth.rate-limit.registration.window-hours=24
auth.rate-limit.password-reset.max-attempts=3
auth.rate-limit.password-reset.window-hours=24
auth.rate-limit.email-verification.max-attempts=3
auth.rate-limit.email-verification.window-hours=1
auth.rate-limit.api.max-requests=100
auth.rate-limit.api.window-minutes=1

# =============================================================================
# Account Lockout
# =============================================================================
auth.lockout.max-attempts=5
auth.lockout.duration-minutes=30
auth.lockout.progressive-duration=true
auth.lockout.max-duration-hours=24

# =============================================================================
# Session Management
# =============================================================================
auth.session.max-concurrent-sessions=5
auth.session.inactivity-timeout-minutes=30
auth.session.absolute-timeout-hours=24
auth.session.cleanup-interval-minutes=15

# =============================================================================
# Email Configuration
# =============================================================================
auth.email.verification.required=true
auth.email.verification.token-expiry-hours=24
auth.email.verification.max-resend-attempts=3
auth.email.verification.resend-cooldown-minutes=5
auth.email.from=noreply@legacykeep.com
auth.email.from-name=LegacyKeep

# =============================================================================
# Service Communication
# =============================================================================
auth.user-service.url=${USER_SERVICE_URL:http://localhost:8082}
auth.user-service.timeout=5000
auth.user-service.retry-attempts=3
auth.user-service.circuit-breaker.enabled=true
auth.user-service.circuit-breaker.failure-rate-threshold=50
auth.user-service.circuit-breaker.wait-duration=5000

# =============================================================================
# Security Configuration
# =============================================================================
# CORS Configuration
spring.web.cors.allowed-origins=${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:8080}
spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.allow-credentials=true
spring.web.cors.max-age=3600

# Security Headers
server.servlet.session.cookie.http-only=true
server.servlet.session.cookie.secure=false
server.servlet.session.cookie.same-site=strict

# =============================================================================
# Monitoring & Health Checks
# =============================================================================
# Actuator Configuration
management.endpoints.web.exposure.include=health,info,metrics,prometheus,env,configprops
management.endpoint.health.show-details=when-authorized
management.endpoint.health.show-components=always
management.endpoints.web.base-path=/actuator

# Metrics Configuration
management.metrics.export.prometheus.enabled=true
management.metrics.tags.application=${spring.application.name}
management.metrics.tags.environment=${spring.profiles.active:default}

# Health Check Configuration
management.health.redis.enabled=true
management.health.db.enabled=true
management.health.diskspace.enabled=true

# =============================================================================
# Logging Configuration
# =============================================================================
logging.level.com.legacykeep.auth=INFO
logging.level.org.springframework.security=INFO
logging.level.org.springframework.web=INFO
logging.level.org.hibernate.SQL=INFO
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n
logging.pattern.file=%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{36} - %msg%n

# =============================================================================
# Performance Configuration
# =============================================================================
# Connection Pool
spring.datasource.hikari.maximum-pool-size=20
spring.datasource.hikari.minimum-idle=5
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000

# JPA Performance
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true
spring.jpa.properties.hibernate.jdbc.batch_versioned_data=true

# =============================================================================
# Feature Flags
# =============================================================================
auth.features.two-factor-authentication.enabled=false
auth.features.social-login.enabled=false
auth.features.phone-verification.enabled=false
auth.features.advanced-audit-logging.enabled=true
auth.features.rate-limiting.enabled=true
auth.features.session-management.enabled=true

# =============================================================================
# Encryption Configuration
# =============================================================================
auth.encryption.secret-key=${ENCRYPTION_SECRET_KEY:default-encryption-key-change-in-production}

# =============================================================================
# Kafka Configuration
# =============================================================================
# Kafka Bootstrap Servers
spring.kafka.bootstrap-servers=${KAFKA_BOOTSTRAP_SERVERS:localhost:9092}

# Kafka Producer Configuration
spring.kafka.producer.client-id=auth-service-producer
spring.kafka.producer.acks=all
spring.kafka.producer.retries=3
spring.kafka.producer.batch-size=16384
spring.kafka.producer.linger-ms=10
spring.kafka.producer.buffer-memory=33554432
spring.kafka.producer.compression-type=lz4
spring.kafka.producer.max-in-flight-requests-per-connection=5
spring.kafka.producer.request-timeout-ms=30000
spring.kafka.producer.delivery-timeout-ms=120000

# Kafka Topic Names
kafka.topics.user-events=user.events
kafka.topics.auth-events=auth.events

# =============================================================================
# Swagger/OpenAPI Configuration
# =============================================================================

# Swagger UI Configuration
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.api-docs.path=/v3/api-docs
springdoc.swagger-ui.enabled=true
springdoc.api-docs.enabled=true

# =============================================================================
# Development/Testing Configuration
# =============================================================================
# Disable security for development endpoints
management.endpoints.web.exposure.include=*
management.endpoint.health.show-details=always
